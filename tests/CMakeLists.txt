# # tests/CMakeLists.txt

# set(CMAKE_AUTOMOC ON)  # üî• –í–æ—Ç —ç—Ç–æ –Ω—É–∂–Ω–æ

# find_package(Qt6 REQUIRED COMPONENTS Test Core)
# include_directories(${CMAKE_CURRENT_SOURCE_DIR})

# add_executable(test_ProtocolMessage test_ProtocolMessage.cpp)
# target_link_libraries(test_ProtocolMessage PRIVATE CDNProtocol Qt6::Test Qt6::Core)
# add_test(NAME ProtocolMessageTests COMMAND test_ProtocolMessage)

# add_executable(test_CommandRegistry test_CommandRegistry.cpp)
# target_link_libraries(test_CommandRegistry PRIVATE CDNProtocol Qt6::Test Qt6::Core)
# add_test(NAME CommandRegistryTests COMMAND test_CommandRegistry)
set(CMAKE_AUTOMOC ON)  # üî• –î–ª—è Q_OBJECT –≤ —Ç–µ—Å—Ç–∞—Ö

find_package(Qt6 REQUIRED COMPONENTS Test Core)
include_directories(${CMAKE_CURRENT_SOURCE_DIR})

# –ü—É—Ç—å –∫ —Å–æ–±—Ä–∞–Ω–Ω–æ–π DLL
# get_target_property(CDNProtocol_DLL_PATH CDNProtocol LOCATION)

# ----------------- test_ProtocolMessage -----------------
add_executable(test_ProtocolMessage test_ProtocolMessage.cpp)
target_link_libraries(test_ProtocolMessage PRIVATE CDNProtocol Qt6::Test Qt6::Core)
add_test(NAME ProtocolMessageTests COMMAND test_ProtocolMessage)

# üîÅ –ö–æ–ø–∏—Ä—É–µ–º DLL –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å .exe
add_custom_command(TARGET test_ProtocolMessage POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
        $<TARGET_FILE:CDNProtocol>
        $<TARGET_FILE_DIR:test_ProtocolMessage>
)


# ----------------- test_CommandRegistry -----------------
add_executable(test_CommandRegistry test_CommandRegistry.cpp)
target_link_libraries(test_CommandRegistry PRIVATE CDNProtocol Qt6::Test Qt6::Core)
add_test(NAME CommandRegistryTests COMMAND test_CommandRegistry)

# üîÅ –ö–æ–ø–∏—Ä—É–µ–º DLL –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å .exe
add_custom_command(TARGET test_CommandRegistry POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
        $<TARGET_FILE:CDNProtocol>
        $<TARGET_FILE_DIR:test_CommandRegistry>
)
